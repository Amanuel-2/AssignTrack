<!DOCTYPE html>
<html lang="en">

<head>
    <title>AssignTrack</title>
    <meta charset="UTF-8">
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
</head>

<body>

<!-- Mobile top bar -->
<div class="mobile-topbar">
    <button class="mobile-hamburger" id="mobileHamburger" aria-label="Open menu">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <span class="mobile-brand">AssignTrack</span>
</div>

<div class="layout" id="layout">

    <!-- Overlay (mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a class="sidebar-brand" href="{% url 'home' %}">AssignTrack</a>
            <button class="sidebar-toggle" id="sidebarToggle" title="Collapse sidebar" aria-label="Toggle sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
        </div>

        <nav class="sidebar-nav">

            <!-- Home -->
            <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}"
               href="{% url 'home' %}" title="Home">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span class="nav-text">Home</span>
            </a>

            {% if user.is_authenticated %}

                {% if user.profile.role == "lecturer" %}

                    <!-- Dashboard (instructor) -->
                    <a class="nav-link {% if request.resolver_match.url_name == 'instructor_dashboard' %}active{% endif %}"
                       href="{% url 'instructor_dashboard' %}" title="Dashboard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        <span class="nav-text">Dashboard</span>
                    </a>

                    <!-- Create Assignment -->
                    <a class="nav-link {% if request.resolver_match.url_name == 'instructor_assignment_create' %}active{% endif %}"
                       href="{% url 'instructor_assignment_create' %}" title="Create Assignment">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        <span class="nav-text">Create Assignment</span>
                    </a>

                    <!-- Courses -->
                    <a class="nav-link" href="{% url 'instructor_dashboard' %}" title="Courses">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                        <span class="nav-text">Courses</span>
                    </a>

                {% else %}

                    <!-- Dashboard (student) -->
                    <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
                       href="{% url 'dashboard' %}" title="Dashboard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        <span class="nav-text">Dashboard</span>
                    </a>

                {% endif %}

                <!-- Profile -->
                <a class="nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %}"
                   href="{% url 'profile' %}" title="Profile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span class="nav-text">Profile</span>
                </a>

                <div class="nav-divider"></div>

                <!-- Logout -->
                <a class="nav-link nav-link-danger" href="{% url 'logout' %}" title="Logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    <span class="nav-text">Logout</span>
                </a>

            {% else %}

                <!-- Login -->
                <a class="nav-link {% if request.resolver_match.url_name == 'login' %}active{% endif %}"
                   href="{% url 'login' %}" title="Login">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    <span class="nav-text">Login</span>
                </a>

                <!-- Register -->
                <a class="nav-link {% if request.resolver_match.url_name == 'register' %}active{% endif %}"
                   href="{% url 'register' %}" title="Register">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                    <span class="nav-text">Register</span>
                </a>

            {% endif %}

        </nav>

        {% if user.is_authenticated %}
        <div class="sidebar-user">
            <div class="sidebar-user-avatar">{{ user.username|slice:":1"|upper }}</div>
            <span class="nav-text sidebar-username">{{ user.username }}</span>
        </div>
        {% endif %}
    </aside>

    <!-- Main content -->
    <main class="main-content">
        {% block content %}
        {% endblock %}
    </main>

</div>

<script>
    const layout = document.getElementById('layout');
    const toggleBtn = document.getElementById('sidebarToggle');
    const overlay = document.getElementById('sidebarOverlay');
    const hamburger = document.getElementById('mobileHamburger');

    // Restore desktop collapse state
    if (window.innerWidth >= 769 && localStorage.getItem('sidebarCollapsed') === 'true') {
        layout.classList.add('collapsed');
    }

    if (toggleBtn) {
        toggleBtn.addEventListener('click', function () {
            layout.classList.toggle('collapsed');
            localStorage.setItem('sidebarCollapsed', layout.classList.contains('collapsed'));
        });
    }

    if (hamburger) {
        hamburger.addEventListener('click', function () {
            layout.classList.toggle('mobile-open');
        });
    }

    if (overlay) {
        overlay.addEventListener('click', function () {
            layout.classList.remove('mobile-open');
        });
    }
</script>

</body>
</html>
